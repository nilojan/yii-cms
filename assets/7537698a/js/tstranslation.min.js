$(document).ready(function(){thisUrl=$("#tstranslationControllerUrl").val()+"/";$(".tstranslation-list table tbody").sortable();$(".tstranslation-list table tbody").disableSelection();orderCount=0;$(document).on("sortupdate",".tstranslation-list table tbody",function(a,b){if(orderCount==0){$(".ts-add-language").parents("span").prepend('<button type="button" class="btn btn-info ts-save-ordering" data-tstoggle="tooltip" title="save current ordering for frontend language widget"><i class="glyphicon glyphicon-list">&nbsp;&nbsp;</i>Save ordering</button>');orderCount++}});$(document).on("click",".ts-save-ordering",function(){var b=new Array();var a=thisUrl+"saveOrdering";$.each($(".tstranslation-list table tbody tr"),function(c){b[c]=$(this).find(".ts-remove").attr("data-id")});$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader($(".ts-save-ordering i")),data:{languageList:b},success:function(c){data=JSON.parse(c);if(data.ok==1){$(".ts-save-ordering").tooltip("hide");$(".ts-save-ordering").remove();orderCount=0}else{alert(data.message)}tstranslationEndLoader($(".ts-save-ordering i"))}},false)});$(document).on("click",".ts-remove",function(){var a=prompt("Delete translated messages also (no/yes)?","no");if(a=="no"||a=="yes"){var d=$(this).attr("data-id");var b=thisUrl+"removeLanguage";var c=$(this);$.ajax({type:"POST",url:b,beforeSend:tstranslationStartLoader(c.parents("tr").find(".for-loader")),data:{id:d,deleteTranslations:a},success:function(e){data=JSON.parse(e);if(data.ok==1){c.parents("tr").remove()}else{alert(data.message)}tstranslationEndLoader(c.parents("tr").find(".for-loader"))}},false)}});$(document).on("click",".ts-change-status",function(){var c=$(this).attr("data-id");var a=thisUrl+"changeStatus";var b=$(this);$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader(b.parents("tr").find(".for-loader")),data:"id="+c,success:function(d){data=JSON.parse(d);if(data.ok==1){var e=b.parents("tr").find(".ts-status");if(data.status==1){e.removeClass("alert-danger").removeClass("badge-important").addClass("alert-success").addClass("badge-success");e.html("Active")}else{e.removeClass("alert-success").removeClass("badge-success").addClass("alert-danger").addClass("badge-important");e.html("Not active")}}else{alert(data.message)}tstranslationEndLoader(b.parents("tr").find(".for-loader"))}},false)});$(document).on("click",".ts-make-default",function(){if(confirm("Change default language?")){var c=$(this).attr("data-id");var a=thisUrl+"makeDefault";var b=$(this);$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader(b.parents("tr").find(".for-loader")),data:"id="+c,success:function(d){data=JSON.parse(d);if(data.ok==1){defaultSpan=b.parents("table").find(".ts-default").clone();b.parents("table").find(".ts-default").remove();b.parents("tr").find(".ts-status").after(defaultSpan)}else{alert(data.message)}tstranslationEndLoader(b.parents("tr").find(".for-loader"))}},false)}});$(document).on("change",".ts-add-language",function(){if($(this).val()!=""&&confirm("Add new language?")){$(this).parent("span").removeClass("open");var b=$(this).val();var a=thisUrl+"addLanguage";$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader($(".ts-add-language").prev("button").find("i")),data:"id="+b,success:function(c){data=JSON.parse(c);if(data.ok==1){window.location=data.redirectUrl}else{alert(data.message)}tstranslationEndLoader($(".ts-add-language").prev("button").find("i"))}},false)}});$(document).on("click",".ts-translate",function(){if(!$(this).hasClass("active")){var g=$(".ts-translate");$.each(g,function(){$(this).removeClass("active");$(this).find("i").removeClass("glyphicon-check")});$(this).addClass("active");$(this).find("i").addClass("glyphicon-check");$(".tstranslation-category-tabs").css({display:"block"});var f=$(this);var h=f.attr("data-language");var a=$(".tstranslation-category-tabs li.active").find("a");if(typeof a.attr("href")!=="undefined"){var c=a.attr("href").split("#").pop();var b=$("#"+c+"").attr("data-language");if(typeof b==="undefined"||b!=h){$("#"+c+'[data-language="'+b+'"]').remove();var d=thisUrl+"getTranslationsByCategory";var e=a.attr("data-category");$.ajax({type:"POST",url:d,beforeSend:function(){tstranslationStartLoader(a.parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"));a.parents(".tstranslation-category-tabs").next("div.tab-content").find(".tab-pane").each(function(){$(this).removeClass("active")})},data:{language:h,category:e,listId:c},success:function(i){a.parents(".tstranslation-category-tabs").next("div.tab-content").append(i);tstranslationEndLoader(a.parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"))}},false)}}}});$(document).on("show.bs.tab",".tstranslation-category-tabs li",function(h){var g=h.target;var d=g.href.split("#");var b=d.pop();var a=$("#"+b+"").attr("data-language");var i=$(".ts-translate.active").attr("data-language");if(typeof i==="undefined"){alert("Select language!")}else{if(typeof a==="undefined"||a!=i){$("#"+b+'[data-language="'+a+'"]').remove();var c=thisUrl+"getTranslationsByCategory";var f=$(g).attr("data-category");$.ajax({type:"POST",url:c,beforeSend:function(){tstranslationStartLoader($(g).parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"));$(g).parents(".tstranslation-category-tabs").next("div.tab-content").find(".tab-pane").each(function(){$(this).removeClass("active")})},data:{language:i,category:f,listId:b},success:function(e){$(g).parents(".tstranslation-category-tabs").next("div.tab-content").append(e);tstranslationEndLoader($(g).parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"))}},false)}}return true});$(document).on("click",".editable-google-translate",function(d){var a=thisUrl+"googleTranslate";var c=$(this).parents(".control-group").find(".editable-input").find("textarea");var b=c.val();var f=$(".tstranslation-list .ts-translate.active").attr("data-language");$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader(c.parents(".control-group").find(".for-loader")),data:{value:b,language:f},success:function(e){var g=JSON.parse(e);if(g.ok==1){c.val(g.message)}else{alert(g.message)}tstranslationEndLoader(c.parents(".control-group").find(".for-loader"))}},false)});$(document).on("click",".google-translate-all",function(d){var b=thisUrl+"googleTranslate";var c=$(this).parents("table").find(".translate-div").find('.translate-value:not(".editable-unsaved")');if(c.length!=0){var a=$(this).parents(".tab-pane.active").find(".progress");a.attr("style","display:block");multiTranslate(c,b,a)}});$(document).on("click",".save-all",function(d){var b=thisUrl+"saveTranslate";var c=$(this).parents("table").find(".translate-div").find(".translate-value.editable-unsaved");if(c.length!=0){var a=$(this).parents(".tab-pane.active").find(".progress");a.attr("style","display:block");multiSave(c,b,a)}});$(document).on("click",".ts-add-language",function(a){a.stopPropagation()});$(document).on("click","#tsLangChangerForm a",function(c){c.prventDefault;var b=$(this);b.parents(".ts-language-widget").find(".open").removeClass("open");if(!b.hasClass("ts-current-lang-link")){var a=b.attr("data-language");$("input#tsNewLang").val(a);$("#tsLangChangerForm").submit();return false}})});function multiTranslate(d,b,j){var c="";var a=0;var f=0;var h=d.length;var e=$(".tstranslation-list .ts-translate.active").attr("data-language");var g=j.find(".progress-bar");$.each(d,function(){var k=$(this);var i=k.text();$.ajax({type:"POST",url:b,data:{value:i,language:e},success:function(l){var m=JSON.parse(l);if(m.ok==1){f++;a=(f/h)*100;a=a+"%";g.css({width:a});if(i!="Empty"){k.text(m.message);if(i!=m.message){$(k).editable("setValue",m.message);k.addClass("editable-unsaved")}}else{$(k).editable("setValue","")}}else{alert(m.message)}if(f==h){setTimeout(function(){j.slideUp("slow");g.css({width:"0%"})},2000)}}},false)})}function multiSave(c,b,j){var k="";var d=0;var a=0;var f=0;var h=c.length;var e=$(".tstranslation-list .ts-translate.active").attr("data-language");var g=j.find(".progress-bar");$.each(c,function(){var m=$(this);var i=m.text();var l=m.attr("data-pk");$.ajax({type:"POST",url:b,data:{pk:l,value:i,name:e},success:function(n){var o=JSON.parse(n);if(o.ok==1){f++;m.removeClass("editable-unsaved");a=(f/h)*100;a=a+"%";g.css({width:a})}else{alert(o.message)}if(f==h){setTimeout(function(){j.slideUp("slow");g.css({width:"0%"})},2000)}}},false)})}function tstranslationStartLoader(a){a.html('<img src="'+$("#tstranslationAssetsUrl").val()+'/images/ajax-loader2.gif">');$("body").css({cursor:"wait"})}function tstranslationEndLoader(a){a.html("&nbsp;&nbsp;");$("body").css({cursor:"auto"})};